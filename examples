# -*- coding: utf-8 -*-
"""
统一动态度评分 - 快速使用示例
"""

from video_processor import VideoProcessor


def example_basic():
    """示例1：基本使用"""
    print("="*70)
    print("示例1：基本使用")
    print("="*70)
    
    # 创建处理器（统一动态度评分已自动集成）
    processor = VideoProcessor(
        device='cuda',  # 或 'cpu'
        enable_camera_compensation=True  # 默认启用
    )
    
    # 处理视频
    frames = processor.load_video("your_video.mp4")
    result = processor.process_video(frames, output_dir="output")
    
    # 获取统一动态度分数
    unified_score = result['unified_dynamics']['unified_dynamics_score']
    category = result['dynamics_classification']['category']
    scene_type = result['unified_dynamics']['scene_type']
    
    print(f"\n结果:")
    print(f"  统一动态度分数: {unified_score:.3f}")
    print(f"  场景类型: {scene_type}")
    print(f"  分类: {category}")
    
    return result


def example_batch():
    """示例2：批量处理"""
    print("\n" + "="*70)
    print("示例2：批量处理")
    print("="*70)
    
    processor = VideoProcessor(device='cuda')
    
    video_list = ["video1.mp4", "video2.mp4", "video3.mp4"]
    results = []
    
    for video_path in video_list:
        frames = processor.load_video(video_path)
        result = processor.process_video(frames, output_dir=f"output/{video_path}")
        results.append(result)
        
        score = result['unified_dynamics']['unified_dynamics_score']
        print(f"{video_path}: {score:.3f}")
    
    # 统计
    scores = [r['unified_dynamics']['unified_dynamics_score'] for r in results]
    print(f"\n平均动态度: {sum(scores)/len(scores):.3f}")
    
    return results


def example_custom_config():
    """示例3：自定义配置"""
    print("\n" + "="*70)
    print("示例3：自定义配置")
    print("="*70)
    
    from unified_dynamics_scorer import UnifiedDynamicsScorer, DynamicsClassifier
    
    # 创建自定义评分器
    custom_scorer = UnifiedDynamicsScorer(
        mode='dynamic_scene',  # 指定为动态场景
        weights={
            'flow_magnitude': 0.5,
            'spatial_coverage': 0.3,
            'temporal_variation': 0.1,
            'spatial_consistency': 0.05,
            'camera_factor': 0.05
        }
    )
    
    # 创建自定义分类器
    custom_classifier = DynamicsClassifier(
        thresholds={
            'pure_static': 0.10,
            'low_dynamic': 0.30,
            'medium_dynamic': 0.60,
            'high_dynamic': 0.80
        }
    )
    
    # 创建处理器并替换默认评分器
    processor = VideoProcessor(device='cuda')
    processor.unified_scorer = custom_scorer
    processor.dynamics_classifier = custom_classifier
    
    # 处理视频
    frames = processor.load_video("your_video.mp4")
    result = processor.process_video(frames, output_dir="output")
    
    score = result['unified_dynamics']['unified_dynamics_score']
    print(f"自定义配置分数: {score:.3f}")
    
    return result


def example_classification():
    """示例4：分类应用"""
    print("\n" + "="*70)
    print("示例4：分类应用")
    print("="*70)
    
    processor = VideoProcessor(device='cuda')
    
    # 处理视频
    frames = processor.load_video("your_video.mp4")
    result = processor.process_video(frames, output_dir="output")
    
    score = result['unified_dynamics']['unified_dynamics_score']
    category_info = result['dynamics_classification']
    
    # 根据分数进行分类
    if score < 0.2:
        video_type = "静态建筑视频"
        use_case = "适合建筑评估、场景重建"
    elif score < 0.5:
        video_type = "低动态视频"
        use_case = "适合环境监控、慢动作分析"
    elif score < 0.7:
        video_type = "中等动态视频"
        use_case = "适合人物行为分析、日常活动"
    else:
        video_type = "高动态视频"
        use_case = "适合运动分析、舞蹈评估"
    
    print(f"\n分类结果:")
    print(f"  动态度分数: {score:.3f}")
    print(f"  视频类型: {video_type}")
    print(f"  应用场景: {use_case}")
    print(f"  分类详情: {category_info['description']}")
    print(f"  典型例子: {', '.join(category_info['typical_examples'])}")


def example_interpretation():
    """示例5：结果解释"""
    print("\n" + "="*70)
    print("示例5：结果解释")
    print("="*70)
    
    processor = VideoProcessor(device='cuda')
    
    frames = processor.load_video("your_video.mp4")
    result = processor.process_video(frames, output_dir="output")
    
    unified = result['unified_dynamics']
    
    # 显示详细解释
    print("\n统一动态度评估:")
    print(unified['interpretation'])
    
    # 显示各维度贡献
    print("\n各维度贡献:")
    component_scores = unified['component_scores']
    for name, score in sorted(component_scores.items(), key=lambda x: x[1], reverse=True):
        bar = "" * int(score * 20)
        print(f"  {name:20s}: {bar} {score:.3f}")
    
    # 置信度分析
    confidence = unified['confidence']
    print(f"\n置信度: {confidence:.1%}")
    if confidence < 0.6:
        print("  ?? 置信度较低，建议:")
        print("    - 检查视频质量")
        print("    - 增加处理帧数")
        print("    - 确认场景类型")


def example_filter():
    """示例6：视频筛选"""
    print("\n" + "="*70)
    print("示例6：视频筛选")
    print("="*70)
    
    processor = VideoProcessor(device='cuda')
    
    video_database = [
        ("static_building.mp4", None),
        ("walking_person.mp4", None),
        ("dancing.mp4", None)
    ]
    
    # 筛选不同类型的视频
    static_videos = []
    dynamic_videos = []
    
    for video_path, _ in video_database:
        frames = processor.load_video(video_path)
        result = processor.process_video(frames, output_dir=f"output/{video_path}")
        
        score = result['unified_dynamics']['unified_dynamics_score']
        
        if score < 0.3:
            static_videos.append((video_path, score))
        else:
            dynamic_videos.append((video_path, score))
    
    print(f"\n静态视频 ({len(static_videos)}):")
    for path, score in static_videos:
        print(f"  {path}: {score:.3f}")
    
    print(f"\n动态视频 ({len(dynamic_videos)}):")
    for path, score in dynamic_videos:
        print(f"  {path}: {score:.3f}")


def main():
    """运行所有示例"""
    print("""
XTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT[
U         统一动态度评分系统 - 使用示例                              U
^TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTa

本脚本展示6个常见使用场景：
1. 基本使用
2. 批量处理
3. 自定义配置
4. 分类应用
5. 结果解释
6. 视频筛选

注意：运行前请确保：
- 安装所需依赖: pip install -r requirements.txt
- 下载RAFT模型: pretrained_models/raft-things.pth
- 准备测试视频

""")
    
    choice = input("选择运行的示例 (1-6, 或 all): ")
    
    if choice == '1' or choice == 'all':
        # example_basic()
        print("示例1：请替换'your_video.mp4'为实际视频路径")
    
    if choice == '2' or choice == 'all':
        # example_batch()
        print("示例2：请准备多个视频文件")
    
    if choice == '3' or choice == 'all':
        # example_custom_config()
        print("示例3：演示自定义配置")
    
    if choice == '4' or choice == 'all':
        # example_classification()
        print("示例4：演示分类应用")
    
    if choice == '5' or choice == 'all':
        # example_interpretation()
        print("示例5：演示结果解释")
    
    if choice == '6' or choice == 'all':
        # example_filter()
        print("示例6：演示视频筛选")
    
    print("""
\nTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT

? 更多信息请查看：
  - UNIFIED_DYNAMICS_GUIDE.md  (详细使用指南)
  - UNIFIED_SOLUTION_SUMMARY.md  (解决方案总结)
  - test_unified_dynamics.py  (单元测试)

? 实际使用：
  python video_processor.py -i your_video.mp4 -o output/

TTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT
""")


if __name__ == '__main__':
    main()

